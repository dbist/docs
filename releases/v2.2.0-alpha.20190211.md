---
title: What&#39;s New in v2.2.0-alpha.20190211
toc: true
summary: Additions and changes in CockroachDB version v2.2.0-alpha.20190211 since version v2.2.0-alpha.20190114
---

## February 11, 2019

Get future release notes emailed to you:

<div class="hubspot-install-form install-form-1 clearfix">
    <script>
        hbspt.forms.create({
            css: '',
            cssClass: 'install-form',
            portalId: '1753393',
            formId: '39686297-81d2-45e7-a73f-55a596a8d5ff',
            formInstanceId: 1,
            target: '.install-form-1'
        });
    </script>
</div>

### Downloads

<div id="os-tabs" class="clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-v2.2.0-alpha.20190211.darwin-10.9-amd64.tgz"><button id="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v2.2.0-alpha.20190211.linux-amd64.tgz"><button id="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v2.2.0-alpha.20190211.windows-6.2-amd64.zip"><button id="windows" data-eventcategory="windows-binary-release-notes">Windows</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v2.2.0-alpha.20190211.src.tgz"><button id="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

### Docker image

{% include copy-clipboard.html %}
~~~shell
$ docker pull cockroachdb/cockroach-unstable:v2.2.0-alpha.20190211
~~~

### Backward-incompatible changes

- The [`CHANGEFEED`](../v2.2/create-changefeed.html) `experimental_avro` format is now backward- and forward-compatible with adjacent schemas for the same table. [#34095][#34095] {% comment %}doc{% endcomment %}

### General changes

- [Go 1.11.4](https://golang.org/dl/) is now the minimum required version necessary to build CockroachDB. [#33668][#33668] {% comment %}doc{% endcomment %}
- Increased the maximum length of queries in crash reports, to make debugging easier. [#34479][#34479]

### Enterprise edition changes

- [`CHANGEFEED`](../v2.2/create-changefeed.html)s now experimentally support writing to cloud storage, for easy use with analytics databases. [#33647][#33647] [#34193][#34193]
- The `CHANGEFEED` `envelope=row` option is now deprecated and will be removed in the Fall 2019 release. The default envelope for new changefeeds is now `wrapped`. [#34309][#34309] {% comment %}doc{% endcomment %}
- `CHANGEFEED`s now operate on an end-to-end "push" model, reducing latency of row changes. Some workloads will also see fewer transaction restarts on tables being watched by `CHANGEFEED`s. [#34457][#34457] {% comment %}doc{% endcomment %}
- Added support for standard HTTP proxy environment variables in HTTP and S3 storage. [#34067][#34067]
- Added support for performing sufficiently old historical reads against the closest replicas rather than leaseholders as well as a new `experimental_follower_read_timestamp()` [built-in function](../v2.2/functions-and-operators.html), which can be used with [`AS OF SYSTEM TIME`](../v2.2/as-of-system-time.html) clauses to generate a timestamp that is likely to be safe for reads from a follower. [#33478][#33478] {% comment %}doc{% endcomment %}

### SQL language changes

- Check constraint adds by default will validate table data with the added constraint asynchronously after the transaction commits. [#32504][#32504]
- NULLs are now supported in int and text arrays in the driver protocol. [#33675][#33675]
- Add binary varbit support over pgwire. [#34050][#34050]
- It is now possible to force a reverse scan of a specific index using `table@{FORCE_INDEX=index,DESC}`. [#34075][#34075]
- Improved output of EXPLAIN for index-join and lookup-join. [#34138][#34138]
- FILTER expressions are now supported by the cost-based optimizer. [#34077][#34077]
- EXPLAIN (OPT) now has a much more brief output, and EXPLAIN (OPT,VERBOSE) and EXPLAIN (OPT,TYPES) can be used for more verbose output. [#34128][#34128]
- Using a sequence as a SELECT target is now supported by the cost-based optimizer. [#33196][#33196]
- Remove the 2.0-off and 2.0-auto distsql modes. All queries are now run via the newer, distsql engine; queries are still only distributed if appropriate. [#34163][#34163]
- The experimental_force_lookup_join setting has been removed. [#34142][#34142]
- Introduced the experimental_reorder_joins flags which will (slowly) attempt to find better join orderings for a query. Not practical for real-world usage today. [#34170][#34170]
- Formatting of timestamps as JSON strings has been changed to always use the RFC3339 format instead of Cockroach's customary format. Users can now expect to see a `T` separator instead of a space between the date and time components. [#34412][#34412]
- Introduced a new top-level statement for an experimental version of `CHANGEFEED`, which doesn't require an enterprise license and returns results as a stream over the sql connection. [#34386][#34386]
- Pgwire result buffer size can now be controlled on a per-connection basis with the results_buffer_size connection string param [#34385][#34385]
- CREATE STATISTICS now runs as a job instead of as a regular SQL statement. [#34279][#34279]
- INTERVAL values are now stored with microsecond precision instead of nanoseconds. Existing intervals with nanoseconds are no longer able to return their nanosecond part. An existing table t with nanoseconds in intervals of column s can round them to the nearest microsecond with `UPDATE t SET s = s + '0s'`. Note that this could potentially cause uniqueness problems if the interval is a primary key. [#34202][#34202]
- Add support for `AS OF SYSTEM TIME` clauses in `BEGIN TRANSACTION` and `SET TRANSACTION` statements which enables entire read-only transactions to be run against a historical timestamp. This functionality simplifies performing complex analytics against a consistent snapshot of historical data and eases the burden to use historical reads with ORMs which generally make modifying the syntax of generated `SELECT` statements difficult. [#34305][#34305]
- Modify the behavior of `now()` inside of historical `SELECT ... AS OF SYSTEM TIME` queries to reflect the historical timestamp at which the query is being run rather than the current clock time when the statement is executed. [#34305][#34305]
- Delete statements are now planned by the cost- based optimizer. The ORDER BY clause can no longer be used with a DELETE statement when there is no LIMIT clause present. Sorting the output should instead be done using SELECT..FROM [DELETE ..] ORDER BY .. [#34303][#34303]
- Replaced experimental_reorder_joins session variable with experimental_reorder_joins_limit, which will reorder joins in queries with fewer than the specified number of joins. [#34375][#34375]
- The cost-based optimizer will now reorder up to 4 joins by default to attempt to find a better ordering of them. This behaviour can be disabled per-session by setting the `experimental_reorder_joins_limit` session variable to 0. [#34549][#34549]
- Enabled automatic statistics collection. [#34529][#34529]
- Delete, Update, and Upsert statements are now planned by the cost-based optimizer. [#34522][#34522]

### Command-line changes

- Populate mod time in `debug zip` [#33714][#33714]
- The informational message printed upon `cockroach start --join` when a node is started the first time has been reworded, to emphasize that joining a running cluster is the preferred course of action. [#33435][#33435]
- Fix a bug in `node status` which prevented it from displaying down nodes in the cluster in some circumstances. [#34448][#34448]

### Admin UI changes

- Added a debug endpoint listing the hottest ranges by QPS on each node/store. [#33336][#33336]
- Improved performance of graph detail tooltips when viewing long timespans (e.g. 1 month) [#34032][#34032]
- `CHANGEFEED` metrics are now exposed in the UI. [#34427][#34427]

### Bug fixes

- Resolve a cluster degradation scenario that could occur during IMPORT/RESTORE operations, manifested through a high number of pending Raft snapshots. [#33582][#33582]
- Fixed a bug where some comparison operations with constant inputs were not getting folded during query optimization, causing the optimizer to produce less-good plans. [#33597][#33597]
- Window functions with non-empty PARTITION BY and ORDER BY clauses are now handled correctly when invoked via an external driver. [#33591][#33591]
- Fix a memory leak around DEALLOCATE and DISCARD statements that could result in crashes with the "unexpected <amount> leftover bytes" message. [#33423][#33423]
- Lookup joins preserve their input order even if more than one row of the input corresponds to the same row of the lookup table. [#33536][#33536]
- Fixed a crash that occurred when performing an INSERT ON CONFLICT with a SET UPDATE that uses values from a subquery. [#33553][#33553]
- Preparing queries with missing placeholders (e.g. `SELECT $2::int`) now results in an error. [#33716][#33716]
- Fix a goroutine leak that would occur while a cluster was unavailable (or a subset of nodes partitioned away from the cluster) and would cause a resource spike to resolve. [#33282][#33282]
- Fixed crashes or incorrect results in some cases when grouping on constant columns (either with GROUP BY or DISTINCT ON). [#34123][#34123]
- Avoid down-replicating widely replicated ranges when nodes in the cluster are temporarily down. [#34126][#34126]
- CockroachDB will now avoid crashing the node if some internal implementation error prevents proper handling of placeholders (query parameters). [#34134][#34134]
- CockroachDB now enables re-starting a node at an address previously allocated for another node. [#34155][#34155]
- The value of `information_schema.columns.character_maximum_column` is set to NULL for all integer types, for compatibility with PostgreSQL. [#34182][#34182]
- The values reported in `information_schema.columns` for integer columns created prior to CockroachDB v2.1 as BIT (back when CockroachDB mis-defined BIT as a special-case integer) are now fixed and consistent with other integer types. [#34182][#34182]
- The `CHANGEFEED` experimental could sink now orders resolved timestamp files correctly. [#34247][#34247]
- The `CHANGEFEED` experimental cloud sink now supports s3 auth params. [#34247][#34247]
- CockroachDB 2.2-alpha can again be built from sources on FreeBSD (unsupported platform). [#34244][#34244]
- Fix a back up in flow creation observed by "no inbound stream connection" caused by not releasing a lock before attempting a possibly blocking operation. [#34218][#34218]
- `CHANGEFEED` now can be started on tables that have previously been backfilled by schema changes. [#34317][#34317]
- Fix a possible panic in crdb_internal.pretty_key(). [#34480][#34480]
- `CHANGEFEED`s with `changefeed.push.enabled` set to true now resolve timestamps in the presense of inactive ranges. [#34550][#34550]
- Prevent crash when updating a job that doesn't exist. [#34574][#34574]
- Fixed a panic due to incorrect statistics calculations when all values of a column are null. [#34578][#34578]
- Fix bug where lease transfers passed through Snapshots could forget to update in-memory state on the new leaseholder, allowing write-skew between read-modify-write operations. [#34548][#34548]

### Performance improvements

- Reduce the network and storage overhead of multi-Range transactions. [#33566][#33566]
- A query plan cache saves a portion of the planning time for frequent queries. [#34454][#34454]
- Batch transaction record gc requests on a per range basis to reduce the number of raft entries in a high throughput, write heavy, transactional workload. [#34242][#34242]

### Miscellaneous

#### Changes without release note annotation

- [#34006][#34006] [c15cf9d76][c15cf9d76] ui: change redux.serializeState usage to redux.serialize (Txiaozhe)

### Doc updates

Docs team: Please add these manually.

### Contributors

This release includes 258 merged PRs by 29 authors.
We would like to thank the following contributors from the CockroachDB community:

- George Utsin (first-time contributor)
- Txiaozhe (first-time contributor)
- Vijay Karthik

[#32504]: https://github.com/cockroachdb/cockroach/pull/32504
[#33196]: https://github.com/cockroachdb/cockroach/pull/33196
[#33282]: https://github.com/cockroachdb/cockroach/pull/33282
[#33336]: https://github.com/cockroachdb/cockroach/pull/33336
[#33423]: https://github.com/cockroachdb/cockroach/pull/33423
[#33435]: https://github.com/cockroachdb/cockroach/pull/33435
[#33478]: https://github.com/cockroachdb/cockroach/pull/33478
[#33536]: https://github.com/cockroachdb/cockroach/pull/33536
[#33553]: https://github.com/cockroachdb/cockroach/pull/33553
[#33566]: https://github.com/cockroachdb/cockroach/pull/33566
[#33571]: https://github.com/cockroachdb/cockroach/pull/33571
[#33582]: https://github.com/cockroachdb/cockroach/pull/33582
[#33591]: https://github.com/cockroachdb/cockroach/pull/33591
[#33597]: https://github.com/cockroachdb/cockroach/pull/33597
[#33647]: https://github.com/cockroachdb/cockroach/pull/33647
[#33668]: https://github.com/cockroachdb/cockroach/pull/33668
[#33675]: https://github.com/cockroachdb/cockroach/pull/33675
[#33714]: https://github.com/cockroachdb/cockroach/pull/33714
[#33716]: https://github.com/cockroachdb/cockroach/pull/33716
[#34006]: https://github.com/cockroachdb/cockroach/pull/34006
[#34032]: https://github.com/cockroachdb/cockroach/pull/34032
[#34050]: https://github.com/cockroachdb/cockroach/pull/34050
[#34067]: https://github.com/cockroachdb/cockroach/pull/34067
[#34075]: https://github.com/cockroachdb/cockroach/pull/34075
[#34077]: https://github.com/cockroachdb/cockroach/pull/34077
[#34095]: https://github.com/cockroachdb/cockroach/pull/34095
[#34123]: https://github.com/cockroachdb/cockroach/pull/34123
[#34126]: https://github.com/cockroachdb/cockroach/pull/34126
[#34128]: https://github.com/cockroachdb/cockroach/pull/34128
[#34134]: https://github.com/cockroachdb/cockroach/pull/34134
[#34138]: https://github.com/cockroachdb/cockroach/pull/34138
[#34142]: https://github.com/cockroachdb/cockroach/pull/34142
[#34155]: https://github.com/cockroachdb/cockroach/pull/34155
[#34163]: https://github.com/cockroachdb/cockroach/pull/34163
[#34170]: https://github.com/cockroachdb/cockroach/pull/34170
[#34182]: https://github.com/cockroachdb/cockroach/pull/34182
[#34193]: https://github.com/cockroachdb/cockroach/pull/34193
[#34202]: https://github.com/cockroachdb/cockroach/pull/34202
[#34218]: https://github.com/cockroachdb/cockroach/pull/34218
[#34242]: https://github.com/cockroachdb/cockroach/pull/34242
[#34244]: https://github.com/cockroachdb/cockroach/pull/34244
[#34247]: https://github.com/cockroachdb/cockroach/pull/34247
[#34279]: https://github.com/cockroachdb/cockroach/pull/34279
[#34303]: https://github.com/cockroachdb/cockroach/pull/34303
[#34305]: https://github.com/cockroachdb/cockroach/pull/34305
[#34309]: https://github.com/cockroachdb/cockroach/pull/34309
[#34317]: https://github.com/cockroachdb/cockroach/pull/34317
[#34375]: https://github.com/cockroachdb/cockroach/pull/34375
[#34385]: https://github.com/cockroachdb/cockroach/pull/34385
[#34386]: https://github.com/cockroachdb/cockroach/pull/34386
[#34412]: https://github.com/cockroachdb/cockroach/pull/34412
[#34427]: https://github.com/cockroachdb/cockroach/pull/34427
[#34448]: https://github.com/cockroachdb/cockroach/pull/34448
[#34454]: https://github.com/cockroachdb/cockroach/pull/34454
[#34457]: https://github.com/cockroachdb/cockroach/pull/34457
[#34479]: https://github.com/cockroachdb/cockroach/pull/34479
[#34480]: https://github.com/cockroachdb/cockroach/pull/34480
[#34522]: https://github.com/cockroachdb/cockroach/pull/34522
[#34529]: https://github.com/cockroachdb/cockroach/pull/34529
[#34548]: https://github.com/cockroachdb/cockroach/pull/34548
[#34549]: https://github.com/cockroachdb/cockroach/pull/34549
[#34550]: https://github.com/cockroachdb/cockroach/pull/34550
[#34574]: https://github.com/cockroachdb/cockroach/pull/34574
[#34578]: https://github.com/cockroachdb/cockroach/pull/34578
[c15cf9d76]: https://github.com/cockroachdb/cockroach/commit/c15cf9d76
